; Fine-Tuned PHP Configuration for GLPI
; Optimized for: Balanced performance and functionality
; Apply to: /etc/php/8.4/fpm/conf.d/99-glpi-finetuned.ini
; Generated: December 9, 2025

[PHP]

; ═══════════════════════════════════════════════════════════════════════
; RESOURCE LIMITS (Fine-Tuned)
; ═══════════════════════════════════════════════════════════════════════

; Maximum memory per script: 512MB (balanced)
memory_limit = 512M

; Maximum execution time: 300 seconds (5 minutes)
max_execution_time = 300

; Maximum input parsing time: 120 seconds
max_input_time = 120

; ═══════════════════════════════════════════════════════════════════════
; FILE UPLOAD LIMITS
; ═══════════════════════════════════════════════════════════════════════

; Maximum upload file size: 100MB
upload_max_filesize = 100M

; Maximum POST data size: 100MB
post_max_size = 100M

; Maximum number of files per upload: 20
max_file_uploads = 20

; ═══════════════════════════════════════════════════════════════════════
; ERROR HANDLING (Production-Ready)
; ═══════════════════════════════════════════════════════════════════════

; Error reporting: All except notices
error_reporting = E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED

; Display errors: Off (production)
display_errors = Off
display_startup_errors = Off

; Log errors: On
log_errors = On
error_log = /var/log/php8.4-error.log

; ═══════════════════════════════════════════════════════════════════════
; SESSION CONFIGURATION
; ═══════════════════════════════════════════════════════════════════════

; Session lifetime: 1 hour (3600 seconds)
session.gc_maxlifetime = 3600

; Session cookie lifetime: 0 (until browser closes)
session.cookie_lifetime = 0

; Use strict session mode
session.use_strict_mode = 1

; Cookie security
session.cookie_httponly = 1
session.cookie_secure = 0
session.cookie_samesite = "Lax"

; ═══════════════════════════════════════════════════════════════════════
; OUTPUT BUFFERING
; ═══════════════════════════════════════════════════════════════════════

; Output buffering: 4KB
output_buffering = 4096

; Implicit flush: Off
implicit_flush = Off

; ═══════════════════════════════════════════════════════════════════════
; REALPATH CACHE (Performance)
; ═══════════════════════════════════════════════════════════════════════

; Realpath cache size: 4MB
realpath_cache_size = 4M

; Realpath cache TTL: 120 seconds
realpath_cache_ttl = 120

; ═══════════════════════════════════════════════════════════════════════
; DATE/TIME SETTINGS
; ═══════════════════════════════════════════════════════════════════════

; Default timezone
date.timezone = "Europe/Lisbon"

; ═══════════════════════════════════════════════════════════════════════
; MBSTRING SETTINGS
; ═══════════════════════════════════════════════════════════════════════

; Multibyte string encoding
mbstring.internal_encoding = UTF-8
mbstring.http_output = UTF-8

; ═══════════════════════════════════════════════════════════════════════
; MYSQLI SETTINGS
; ═══════════════════════════════════════════════════════════════════════

; MySQL connection cache
mysqli.cache_size = 2000

; Allow persistent connections
mysqli.allow_persistent = On

; Maximum persistent connections: -1 (unlimited)
mysqli.max_persistent = -1

; Maximum links: -1 (unlimited)
mysqli.max_links = -1

; ═══════════════════════════════════════════════════════════════════════
; FINE-TUNING NOTES
; ═══════════════════════════════════════════════════════════════════════
;
; This configuration is optimized for:
; - GLPI web application
; - Moderate file uploads (documents, images)
; - Session-based authentication
; - MySQL/MariaDB backend
; - Production environment
;
; Key settings explained:
;
; memory_limit = 512M
;   - Sufficient for GLPI with plugins
;   - Prevents memory exhaustion
;   - Lower than CLI (which is unlimited)
;
; max_execution_time = 300
;   - 5 minutes for long operations
;   - Bulk imports, mass updates
;   - Inventory synchronization
;
; upload_max_filesize = 100M
;   - Large document uploads
;   - Asset images and attachments
;   - Import files (CSV, XML)
;
; session.gc_maxlifetime = 3600
;   - 1 hour session timeout
;   - Balance between security and usability
;   - Adjust based on organizational policy
;
; realpath_cache_size = 4M
;   - Caches file paths for performance
;   - Reduces filesystem lookups
;   - Improves page load times
;
; Performance impact:
; - Memory per request: 50-150MB typical
; - Peak memory: 512MB per request
; - Total FPM memory: 40 workers × 512MB = 20GB potential
;   (In practice: 40 workers × 70MB avg = 2.8GB actual)
;
; Security considerations:
; - display_errors = Off (don't expose internals)
; - Error logging enabled for debugging
; - Session security flags enabled
; - Cookie security enabled
;
; Monitoring recommendations:
; - Check error log: tail -f /var/log/php8.4-error.log
; - Monitor memory usage per request
; - Track upload sizes and frequencies
; - Review session timeout complaints
;
; Adjustments for specific needs:
; - Increase memory_limit if out-of-memory errors
; - Increase max_execution_time for long imports
; - Adjust session.gc_maxlifetime for user comfort
; - Modify upload limits based on document sizes
;
; ═══════════════════════════════════════════════════════════════════════
