# Optimized MariaDB 11.4 Configuration for GLPI
# For 8GB RAM / 6 CPU cores system

[mysqld]

# Basic Settings
pid-file            = /run/mysqld/mysqld.pid
basedir             = /usr
bind-address        = 127.0.0.1
port                = 3306

# Character Set
character-set-server = utf8mb4
character-set-collations = utf8mb4=utf8mb4_unicode_ci
default-storage-engine = InnoDB

# Logging
expire_logs_days = 10
log_error = /var/log/mysql/error.log

# Performance Settings
max_connections = 200               # Default 151, increased for concurrent requests
max_allowed_packet = 256M           # Allow larger uploads
thread_cache_size = 10
table_open_cache = 4000             # For many tables

# InnoDB Settings (PRIMARY for GLPI)
default-storage-engine = InnoDB
innodb_buffer_pool_size = 4G        # 50% of RAM for InnoDB
innodb_log_file_size = 512M         # Large log file for performance
innodb_flush_log_at_trx_commit = 2  # Balance between safety and performance
innodb_file_per_table = 1           # Each table in separate file
innodb_flush_method = O_DIRECT      # Avoid double buffering

# MyISAM (if needed - minimal)
key_buffer_size = 64M

# Query Optimization
query_cache_type = 0                # Disabled in MariaDB 10.1.3+ (innodb performs better)
query_cache_size = 0

# Temporary Tables
tmp_table_size = 128M               # Larger temp table size
max_heap_table_size = 128M

# Slow Query Log (for monitoring)
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1

# Connection Settings
interactive_timeout = 28800
wait_timeout = 28800
net_read_timeout = 30
net_write_timeout = 60

# Sort and Join
sort_buffer_size = 4M
read_rnd_buffer_size = 2M
join_buffer_size = 4M

# Database Specific
skip-external-locking
symbolic-links = 0

[mysqldump]
quick
quote-names
max_allowed_packet = 256M

[mysqld_safe]
log-error = /var/log/mysql/error.log
pid-file = /run/mysqld/mysqld.pid
